accelerator:
  displayName: Brownfield Function
  description: Accelerator to create a simple Function executing Brownfield APIs
  iconUrl: https://raw.githubusercontent.com/dektlong/dekt-images/80bfdbf23040731d16310e286e7d40b57e3b23d5/tanzu.png
  tags:
  - cloud-native-devs

  options:
  
  #function framework
  - name: functionFramework
    label: Framework
    description: Function implementation framework
    required: true
    defaultValue: go
    inputType: select
    choices:
      - value: go
        text: GoLang
      - value: spring
        text: Spring Native
  
  #app deployment
  - name: appDeploymentType
    label: Deployment environment
    description: Type of deployment configurations
    required: true
    defaultValue: tap
    inputType: select
    choices:
      #- value: k8s
      #  text: K8s simple
      - value: tap
        text: Tanzu Application Platform workload
      - value: kNative
        text: kNative serving
           
  - name: scaleToZero
    label: Scale to zero
    description: Enable function to scale to zero
    inputType: toggle
    dataType: boolean
    dependsOn:
      name: appDeploymentType
      value: kNative
    defaultValue: false
  
  - name: gitRepo
    label: Git repo
    inputType: text
    required: true
    dataType: string
    defaultValue: https://github.com/dektlong/adopter-check
  
  - name: sampleAPI
    label: Sample API
    inputType: text
    display: true
    dataType: string
    defaultValue: https://brownfieldapi.example.com/my-sample-api
  
engine:
  merge:
    #generic transformations
    - includes: ["README.MD"]
      chain:
        - type: ReplaceText
          substitutions:
            - text: app-name
              with: "#artifactId"
    #go framework
    - includes: [ "go/**" ]
      condition: "#functionFramework == 'go'"
      chain:
        - type: ReplaceText
          substitutions:
            - text: app-name
              with: "#artifactId"
            - text: sample-api
              with: "#sampleAPI"
    #java-native framework
    - includes: [ "java-native/**" ]
      condition: "#functionFramework == 'spring'"
      chain:
        - type: ReplaceText
          substitutions:
            - text: app-name
              with: "#artifactId"
            - text: sample-api
              with: "#sampleAPI"
   #deployments
    - includes: [ "config/app-knative.yaml"]
      condition: "#appDeploymentType == 'kNative'"
      chain:
        - type: YTT
    - includes: [ "config/workload.yaml"]
      condition: "#appDeploymentType == 'tap'"
      chain:
        - type: YTT
    - includes: [ "config/app-simple.yaml"]
      condition: "#appDeploymentType == 'k8s'"
      chain:
        - type: YTT
