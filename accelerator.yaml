accelerator:
  displayName: Brownfield Function for Online Stores
  description: Accelerator to create a simple Function executing Brownfield APIs for 3rd party services used by online store
  iconUrl: https://raw.githubusercontent.com/dektlong/dekt-images/80bfdbf23040731d16310e286e7d40b57e3b23d5/tanzu.png
  tags:
  - onlinestore-dev

  options:
  
  #function framework
  - name: functionFramework
    label: Function implementation framework
    description: Function implementation framework
    required: true
    defaultValue: go
    inputType: select
    choices:
      - value: go
        text: GoLang
      - value: spring
        text: Spring Native
  
  #app deployment
  - name: appDeploymentType
    label: App deployment config
    description: Type of deployment configurations
    required: true
    defaultValue: k8s
    inputType: select
    choices:
      - value: k8s
        text: K8s simple
      - value: workload
        text: TAP workload
      - value: cnr
        text: Cloud Native Runtime (kNative)
      - value: cf
        text: Cloud Foundry manifest
        
  - name: scaleToZero
    label: Scale to zero
    description: Enable function to scale to zero
    inputType: toggle
    dataType: boolean
    dependsOn:
      name: appDeploymentType
      value: cnr
    defaultValue: false
    
  - name: gitRepo
    label: Git repo
    inputType: text
    required: true
    dataType: string
    defaultValue: https://github.com/dektlong/adopter-check
  
engine:
  merge:
    #generic transformations
    - includes: ["README.MD"]
      chain:
        - type: ReplaceText
          substitutions:
            - text: app-name
              with: "#artifactId"
    #go framework
    - includes: [ "go/**" ]
      condition: "#functionFramework == 'go'"
      chain:
        - type: ReplaceText
          substitutions:
            - text: app-name
              with: "#artifactId"
            - text: brownfield-api
              with: "#brownfieldAPI"
    #java-native framework
    - includes: [ "java-native/**" ]
      condition: "#functionFramework == 'spring'"
      chain:
        - type: ReplaceText
          substitutions:
            - text: app-name
              with: "#artifactId"
    - includes: [ "accelerators/deployment/app-knative.yaml"]
      condition: "#appDeploymentType == 'cnr'"
      chain:
        - type: ReplaceText
          substitutions:
            - text: app-name
              with: "#artifactId"
            - text: scale-to-zero-value
              with: "#scaleToZero"
